@startuml
participant Client
participant "Cloudflare Edge Cache" as Edge
participant "Apollo Server (Worker)" as Server
participant "Data Source" as DB

Client -> Edge: GraphQL Query (GET)
activate Edge

alt Cache Hit
    Edge -> Client: 200 OK (Cached Response)
else Cache Miss
    Edge -> Server: GraphQL Query (GET)
    activate Server
    Server -> DB: Fetch Data
    DB -> Server: Data
    Server -> Server: Calculate Cache-Control
    Server -> Edge: 200 OK + Cache-Control Header
    deactivate Server
    Edge -> Edge: Store in Cache
    Edge -> Client: 200 OK (Response)
end
deactivate Edge
@enduml
